#!/usr/bin/with-contenv sh

# Get the IP of the current container. We don't want this container to match itself.
HOST_IP=`dig +short $HOSTNAME`
UNIQUE=""

# Loop through each line returned from dig. Look for an IP that doesn't match that of this container.
while IFS= read -r line
do
    if test ! "$HOST_IP" = "$line"; then
        UNIQUE=$line
        break;
    fi
done <<EOF
`dig +short consul @127.0.0.11`
EOF

# If we didn't find another IP, exit 1.
if test -z "$UNIQUE"; then
    exit 1;
fi

# We found one. Exit 0!
echo "$UNIQUE"
exit 0
