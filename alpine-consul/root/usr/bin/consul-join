#!/usr/bin/with-contenv sh

# Get the IP of the current container. We don't want this container to match itself.
HOST_IP=`container-ip`

# Look for an IP that doesn't match that of this container.
JOIN=`container-ip consul | grep -v "$HOST_IP" | awk '{ printf " -retry-join " $0}'`

# If we didn't find another IP, exit 1.
if test -z "$JOIN"; then
    exit 1;
fi

# We found at least one. Exit 0!
echo "$JOIN"
exit 0
